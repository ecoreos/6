<!DOCTYPE html>
<html class="img-no-display">
 <head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
<title>High Availability</title>

<link href="../../help.css" type="text/css" rel="stylesheet" />
<link href="../../scrollbar/flexcroll.css" type="text/css" rel="stylesheet" />
<script type="text/javascript" src="../../scrollbar/flexcroll.js"></script>
<script type="text/javascript" src="../../scrollbar/initFlexcroll.js"></script>

 </head>
 <body>
<h2>切り替え</h2>
  
<p>性能を持続させ、故障によるサーバーのダウン時間を最小限に抑えるために、サービスを high-availability クラスタのアクティブ サーバーから待機中のサーバーである受動サーバーに切り替えることができます。この機能は「切替」、または場合によっては「フェイルオーバー」とも呼ばれます。ここでは、これらの 2 つのコンセプトの基本を説明します。</p>
  
<h3>切り替え</h3>
	<p>「切替え」とは、high-availability クラスタのアクティブ サーバーを待機中のサーバーである、受動サーバーに切り替えることです。正常に作動しているときには、アクティブ サーバーがすべてのサービスを管理します。しかし、アクティブ サーバーが故障した場合、受動サーバーが正常に作動しているものと想定し、すべてのサービスを受動サーバーに切り替えることができます。この場合、アクティブ サーバーは受動サーバーの役割を果たし、受動サーバーはアクティブ サーバーの役割を果たします。</p>
    
<h4>手動で切り替える：</h4>
 <ol>
<li><b>[概要]</b> ページを開きます。</li>
<li><b>[管理]</b> &gt; <b>[切替え]</b> をクリックします。</li>
 </ol>

<div class="section">
<h4>注：</h4>
<p>手動で切り替えを行う前に、切り替え後の IP シフトにより DSM ページが消失してしまわないように、固定 IP を設定して、この固定 IP で DSM にログインすることをお薦めします。</p>
</div>

<div class="section">
<h4>注：</h4>
<p>切替え中は、まずアクティブ サーバーが受動サーバーとなり、次に受動サーバーがアクティブ サーバーになります。つまり短い間ですが両方のサーバーが受動サーバーになる時間が発生し、この時間はサービスを正常に提供することができません。切替に要する時間は、ボリュームや iSCSI LUN（ブロック レベル）の数とサイズ、high-availability クラスタでのサービスとパッケージの数と読み込み量により異なります。</p>
</div>

<h3>フェイルオーバー</h3>
    
<p>エラーが発生すると、サービスの停止時間を最小限に留めるために、自動的にサービスを切替えます。このようなイベントを「フェイルオーバー」と呼びます。次のような場合には、受動サーバーが正常に機能していると仮定して、システムがフェイルオーバーを開始する場合があります。</p>
    
    <ul>
<li><b>停電：</b> 
        <ul>
	<li>アクティブ サーバーがシャットダウンまたはリブートした</li>
<li>アクティブ サーバーの両方の電源が故障した</li>
<li>電源装置がない</li>
      </ul></li>
<li><b>ドライブ エラー：</b> アクティブ サーバーのドライブ パスの数が受動サーバーのその数よりも少ない</li>
<li><b>サービス エラー：</b>監視中のサービスでエラーが発生した</li>
<li><b>接続エラー：</b> 監視インターフェイスで接続エラーが発生した</li>
    </ul>    
     
    
<h3>切替えエラー</h3>
    
		<p>次のような状況では、切替やフェイルオーバーが実行されない場合があります。</p>
  	<ul>
	  <li><b>Heartbeat の異常接続：</b> アクティブ サーバーと受動サーバーの接続状態が正常ではない</li>
	  <li><b>メモリサイズが一致しない：</b> アクティブ サーバーと受動サーバーの RAM サイズが同じではない。</li>
	  <li><b>停電：</b><ul>
	<li>受動サーバーがシャットダウンまたはリブートした</li>
<li>受動サーバーの両方の電源が故障した</li>
<li>電源装置がない</li>
      </ul></li>
	  <li><b>接続エラー：</b> 受動サーバーの監視インターフェイスで接続エラーが発生した</li>
	  <li><b>サービス エラー：</b> 受動サーバーの監視サービスでエラーが発生した</li>
	  <li><b>拡張ユニット接続失敗：</b> 2台のサーバーの拡張ユニットの接続が同じ順番ではない</li>
	  <li><b>ドライブ エラー：</b> 受動サーバーのドライブ パスの数がアクティブ サーバーのその数よりも少ない</li>
<li><b>DSM の更新：</b>DSM アップデートをインストールすると、すべてのサービスが停止します。DSM アップデートのインストールが完了すると、再開されます。</li>      
 </ul>

<p>手動で切替えを行ってもサービスが受動サーバーに切替わらない場合は、システムがサービスをアクティブ サーバーに戻そうとします。</p>

<h3>UPS</h3>
<p>予期しない停電に備えて、high-availability クラスタを UPS に接続することができます。停電になった場合、サーバーは接続されている UPS から電源供給を受けます。アクティブ サーバーに接続されている UPS ユニットの電源が少なくなると、受動サーバーはシャットダウンし、アクティブ サーバーがセーフモードに入ります。電源が復旧したら、アクティブ サーバーがリブートして Wake-on-LAN メッセージを発信し、別のサーバーの電源も入れようとします。</p>
   <ul>
	   <li>両サーバーと拡張ユニットは、ネットワークスイッチと同じ UPS に繋ぐようお薦めします。</li>
   </ul>

<div class="section">
<h4>注：</h4>
<p>DiskStation はネットワーク UPS デバイスにのみ接続できます。詳しくは、<strong>[コントロール パネル]</strong> &gt; <strong>[ハードウェア]</strong> &gt; <strong>[UPS]</strong> のヘルプをご覧ください。</p>
</div>  
 </body>
</html>
