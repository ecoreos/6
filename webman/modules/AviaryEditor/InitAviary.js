/* Copyright (c) 2016 Synology Inc. All rights reserved. */

var imgId="aviary-img";function urlDecode(d,k){var j={},b=d.split("&"),h=decodeURIComponent,g,c;for(var f=0;f<b.length;f++){var a=b[f];a=a.split("=");g=h(a[0]);c=h(a[1]);j[g]=k||!j[g]?c:[].concat(j[g]).concat(c)}return j}function onAviaryLoad(){var h=decodeURIComponent(window.location.search.substr(1)),e=urlDecode(h),g=e.path,a=e.url,c=a.substr(a.lastIndexOf("/")),b=a.substr(0,a.indexOf(c)),f,d;d=function(){var i=function(l){var j=window.location.origin||window.location.protocol+"//"+window.location.hostname+(window.location.port?":"+window.location.port:"");if(j!==l.origin){return}var k=urlDecode(l.data);if(k.savedone||k.saveerror){f.hideWaitIndicator();f.enableControls()}};if(window.addEventListener){window.addEventListener("message",i,false)}else{window.attachEvent("onmessage",i)}};f=new Aviary.Feather({apiKey:"p5iepr9syy19tm1s",apiVersion:2,maxSize:5000,appendTo:"aviary-ct",noCloseButton:true,displayImageSize:true,fileFormat:g.substr(1+g.lastIndexOf(".")).toLowerCase(),language:e.lang,onLoad:function(){f.launch({image:imgId,url:b+encodeURIComponent(c)});d()},onReady:function(){window.parent.postMessage("ready=true","*")},onSave:function(i,j){window.parent.postMessage("save="+j,"*");f.showWaitIndicator();f.disableControls()},onSaveButtonClicked:function(i){window.parent.postMessage("savebtnclicked=true","*")},onError:function(i){window.parent.postMessage("error="+i.code,"*")}})}function loadAviary(){var a="http://feather.aviary.com/js/feather.js",c="https://dme0ih8comzn4.cloudfront.net/js/feather.js",b=document.createElement("script");b.type="text/javascript";b.src=(window.location.protocol==="http:")?a:c;b.onload=onAviaryLoad;b.onreadystatechange=function(){if(this.readyState==="loaded"||this.readyState==="complete"){onAviaryLoad();b.onreadystatechange=null}};document.getElementsByTagName("head")[0].appendChild(b)}function initImg(){var e=document.createElement("img"),f=decodeURIComponent(window.location.search.substr(1)),d=urlDecode(f),a=d.url,c=a.substr(a.lastIndexOf("/")),b=a.substr(0,a.indexOf(c));e.id=imgId;b+=encodeURIComponent(c);e.src=b;e.style.position="absolute";e.style.top="-10000px";e.style.left="-10000px";window.imgEl=document.getElementById("org-img-ct").appendChild(e)}function init(){if(!window.avInitialized){initImg();loadAviary();window.avInitialized=true}}function docReady(a){if(document.readyState==="complete"){init()}}if(window.addEventListener){window.addEventListener("load",init,false)}else{if(window.attachEvent){document.onreadystatechange=docReady}else{var fn=window.onload;window.onload=function(){if(fn){fn()}init()}}};