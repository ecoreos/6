/* Copyright (c) 2016 Synology Inc. All rights reserved. */

Ext.ns("Ext.ux.form");Ext.ux.form.Rater=Ext.extend(Ext.form.NumberField,{unit:20,disabled:false,ratedValue:undefined,maxValue:5,displayValue:undefined,animate:true,rated:false,allowNegative:false,wrapClass:"ux-form-rater-wrap",starsClass:"ux-form-rater-stars",voteClass:"ux-form-rater-vote",votedClass:"ux-form-rater-voted",autoSize:Ext.emptyFn,onRender:function(b,a){Ext.ux.form.Rater.superclass.onRender.call(this,b,a);this.wrap=this.el.wrap({cls:this.wrapClass});if(Ext.isIE){this.wrap.setHeight(this.unit)}this.el.addClass("x-hidden");this.createStars();this.displayValue=(this.displayValue>this.maxValue)?this.maxValue:this.displayValue;if(this.displayValue>0||this.getValue()>0){this.displayRating()}},createStars:function(){if(this.getStars().getCount()>0){return}var b=this.wrap.createChild({tag:"ul",cls:this.starsClass}).setSize(this.unit*this.maxValue,this.unit);var e=new Ext.Template('<li class="rating"></li>');var d=new Ext.Template('<li class="star"></li>');e.append(b,[],true).setHeight(this.unit);for(var a=this.maxValue;a>0;a--){var c=d.append(b,[],true);c.setSize(this.unit*a,this.unit)}this.alignStars()},reInit:function(a){Ext.apply(this,a);this.rated=false;this.setValue(this.value);this.setDisabled(false);this.displayRating()},isRated:function(){return this.rated},getStarsContainer:function(){return this.wrap.select("."+this.starsClass,true).item(0)},getRating:function(){return this.wrap.select("li.rating",true)},getStars:function(){return this.wrap.select("li.star",true)},alignStars:function(){var b=this.getStarsContainer();var c=this.getRating();var a=this.getStars();var e=Ext.fly(document.body).getAlignToXY(b)[0];var d=(b.findParent(".x-form-item",5))?true:false;var f=(b.findParent(".x-editor",5))?true:false;if(!d&&!f){c.setLeft(e);a.setLeft(e)}else{c.alignTo(b,"tl");a.alignTo(b,"tl")}},displayRating:function(c,e){var d=this.getRating();if(Ext.isEmpty(c)){c=(Ext.isEmpty(this.displayValue))?this.getValue():this.displayValue;c=Ext.isEmpty(c)?0:c}else{c=c}if(this.ratedValue>0){c=this.ratedValue;e=true;this.rated=true;this.disabled=true}var b=function(f,g){if(e!==true){d.replaceClass(f,g)}else{d.replaceClass(g,f)}};if(this.animate!==true){b(this.votedClass,this.voteClass);d.setWidth(c*this.unit);return}var a=function(){b(this.votedClass,this.voteClass);d.setWidth(c*this.unit,{easing:"easeIn"}).fadeIn()};d.setWidth(0,{easing:"slideOut",duration:0.45,callback:a,scope:this}).fadeOut()},setValue:function(b,a){if(this.disabled){return}Ext.ux.form.Rater.superclass.setValue.call(this,b);this.rated=true;this.disabled=true;this.displayRating(b,true);this.wrap.dom.qtip=a||b},onDisable:function(){Ext.ux.form.Rater.superclass.onDisable.call(this);this.wrap.addClass("x-item-disabled");this.wrap.dom.qtip=undefined},onEnable:function(){Ext.ux.form.Rater.superclass.onEnable.call(this);this.wrap.removeClass("x-item-disabled")},onHide:function(){this.wrap.addClass("x-hidden")},onShow:function(){this.wrap.removeClass("x-hidden")}});