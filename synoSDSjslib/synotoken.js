/* Copyright (c) 2016 Synology Inc. All rights reserved. */

window.SYNO=window.SYNO||{};window.SYNO.SDS=window.SYNO.SDS||{};window.SYNO.SDS.Session=window.SYNO.SDS.Session||{};window._S=window._S||function(a){return SYNO.SDS.Session[a]};SYNO.SDS.Session.SynoToken="{SYNOTOKEN}";var _urlAppend=Ext.urlAppend;Ext.urlAppend=function(b,c){var a=Ext.urlDecode(c);if(b.indexOf("SynoToken")===-1&&!Ext.isEmpty(_S("SynoToken"))){a.SynoToken=_S("SynoToken")}return _urlAppend(b,Ext.urlEncode(a))};Ext.Ajax.on("beforerequest",function(b,a){if(!Ext.isEmpty(_S("SynoToken"))){if(Ext.isEmpty(a.headers)){a.headers={}}a.headers["X-SYNO-TOKEN"]=_S("SynoToken")}});Ext.util.Observable.observeClass(Ext.form.BasicForm);Ext.form.BasicForm.on("beforeaction",function(a,b){if(a.url){a.url=Ext.urlAppend(a.url)}});Ext.util.Observable.observeClass(Ext.data.Connection);Ext.data.Connection.on("beforerequest",function(a,b){if(!Ext.isEmpty(_S("SynoToken"))){if(Ext.isEmpty(b.headers)){b.headers={}}b.headers["X-SYNO-TOKEN"]=_S("SynoToken")}});